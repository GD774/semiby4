<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.gdu.semiby4.mapper.MainboardMapper">

   <resultMap type="BoardDto" id="BoardMap">
      <id     property="boardNo" column="BOARD_NO" />
      <result property="title" column="TITLE"/>
      <result property="contents" column="CONTENTS"/>
      <result property="createDt" column="CREATE_DT"/>
      <result property="modifyDt" column="MODIFY_DT"/>
    <association property="user" javaType="UserDto">
      <id property="userNo" column="USER_NO"/>
      <result property="email" column="EMAIL"/>
    </association>
  </resultMap>

  <insert id="insertBoard"
          parameterType="BoardDto">
    <selectKey order="BEFORE" keyProperty="boardNo" resultType="int">
      SELECT UPLOAD_SEQ.NEXTVAL
         FROM DUAL
    </selectKey>
     INSERT INTO UPLOAD_T (
          BOARD_NO
        , TITLE
        , CONTENTS
        , CREATE_DT
        , MODIFY_DT
        , USER_NO  
      ) VALUES (
          #{boardNo}
        , #{title}
        , #{contents}
        , TIMESTAMP
        , TIMESTAMP 
        , #{user.userNo}
      )
  </insert>
  
  <insert id="insertAttach"
          parameterType="AttachDto">
  INSERT INTO ATTACH_T (
      ATTACH_NO
    , UPLOAD_PATH
    , FILESYSTEM_NAME
    , ORIGINAL_FILENAME
    , DOWNLOAD_COUNT
    , HAS_THUMBNAIL
    , BOARD_NO
  ) VALUES (
      ATTACH_SEQ.NEXTVAL
    , #{uploadPath}
    , #{filesystemName}
    , #{originalFilename}
    , 0    
    , #{hasThumbnail}
    , #{boardNo}
  )
  </insert>
  
</mapper>