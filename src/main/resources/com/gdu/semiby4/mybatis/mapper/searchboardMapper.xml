<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gdu.semiby4.mapper.SearchboardMapper">

  <resultMap type="BoardDto" id="BoardMap">
    <id     property="boardNo"   column="BOARD_NO" />
    <result property="hit"      column="HIT" />
    <result property="title"    column="TITLE" />
    <result property="contents" column="CONTENTS" />
    <result property="createDt" column="CREATE_DT" />
    <result property="modifyDt" column="MODIFY_DT" />
    <association property="user" javaType="UserDto">
      <id     property="userNo" column="USER_NO" />
      <result property="employeeId"  column="EMPLOYEE_ID" />
    </association>
  </resultMap>

  <select id="getSearchCount"
          parameterType="Map"
          resultType="int">
      SELECT COUNT(*)    
        FROM USER_T U INNER JOIN BOARD_T B
          ON U.USER_NO = B.USER_NO 
        WHERE ${column} LIKE '%' || #{query} || '%'
  </select>
  
  <select id="getSearchList"
          parameterType="Map"
          resultMap="BoardMap">          
    SELECT BOARD_NO, USER_NO, TITLE, CONTENTS, HIT, CREATE_DT, MODIFY_DT
      FROM (SELECT ROW_NUMBER() OVER(ORDER BY BOARD_NO DESC, USER_NO ASC) AS RN, B.BOARD_NO, B.CONTENTS, U.USER_NO, U.EMAIL, B.CREATE_DT, B.HIT, B.TITLE
              FROM USER_T U INNER JOIN BOARD_T B
                ON U.USER_NO = B.USER_NO
             WHERE ${column} LIKE CONCAT(CONCAT('%', #{query}), '%'))
     WHERE RN BETWEEN #{begin} AND #{end}
  </select>
</mapper>
