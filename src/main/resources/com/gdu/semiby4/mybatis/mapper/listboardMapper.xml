<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gdu.semiby4.mapper.ListboardMapper">

  <resultMap type="BoardDto" id="BoardMap">
    <id     property="boardNo"    column="BOARD_NO" />    
    <result property="hit"       column="HIT"/>
    <result property="title"       column="TITLE"/>
    <result property="contents"    column="CONTENTS"/>
    <result property="createDt"    column="CREATE_DT"/>
    <result property="modifyDt"    column="MODIFY_DT"/>
    <association property="user" javaType="UserDto">
      <id     property="userNo" column="USER_NO"/>
      <result property="email"  column="EMAIL"/>
    </association>
  </resultMap>


  <select id="getBoardCount">
    SELECT COUNT(*)
      FROM BOARD_T
  </select>
  
  <select id="getBoardList"
          parameterType="Map"
          resultMap="BoardMap">
    SELECT BOARD_NO, TITLE, CONTENTS, CREATE_DT, MODIFY_DT
         , USER_NO, EMAIL
      FROM (SELECT ROW_NUMBER() OVER (ORDER BY BOARD_NO ${sort}) AS RN
                 , B.BOARD_NO, B.TITLE, B.CONTENTS, B.CREATE_DT, B.MODIFY_DT
                 , USR.USER_NO, USR.EMAIL
                 , (SELECT COUNT(*)
                      FROM ATTACH_T ATC
                     WHERE B.BOARD_NO = ATC.BOARD_NO) AS ATTACH_COUNT
              FROM USER_T USR INNER JOIN BOARD_T B
                ON USR.USER_NO = B.USER_NO)
     WHERE RN BETWEEN #{begin} AND #{end}
  </select>
  
  <select id="getBoardByNo"
          resultMap="BoardMap">
    SELECT B.BOARD_NO, B.TITLE, B.CONTENTS, B.CREATE_DT, B.MODIFY_DT
         , USR.USER_NO, USR.EMAIL
      FROM USER_T USR INNER JOIN BOARD_T B
        ON USR.USER_NO = B.USER_NO
     WHERE B.BOARD_NO = #{boardNo}
  </select>
  


  
</mapper>